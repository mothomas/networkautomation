---
- name: Retrieve network configurations
  hosts: junos
  gather_facts: False

  tasks:

   - name: Ensure netconf is running
     vars:
       ansible_connection: network_cli
     junipernetworks.junos.junos_command:
       commands: show version
     
    
   - name: Backup junos configuration
     vars:
       ansible_connection: netconf
     junipernetworks.junos.junos_config:
       backup: true
       backup_options:
         dir_path: /tmp/
         filename: "{{ inventory_hostname }}.txt"
     register: config_output



---
- name: Retrieve network configurations
  hosts: "{{ hosts }}"
  serial: 3
  gather_facts: False

  tasks:
    - name: Initialize host_ip as an empty list
      ansible.builtin.set_fact:
        host_ip: []

    - name: Append ansible_host to host_ip_list for Junos devices
      ansible.builtin.set_fact:
        host_ip: "{{ host_ip + [ansible_host] }}"
      when: ansible_network_os is defined and ansible_network_os == 'junos'

    - name: Display the host_ip_list
      ansible.builtin.debug:
        msg: "{{ host_ip }}"
      run_once: true

